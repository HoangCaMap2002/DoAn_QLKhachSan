@{
    Layout = null;
    ViewData["Title"] = "Phong theo khach san";
    int idks = Model[0].Phong.IdKhachSanNavigation.Id;
}
@using DoAn_QLKhachSan.ViewModels;
@using DoAn_QLKhachSan.Extension;
@model List<PhongModel>
@functions {
    QuanLyKhachSanContext db = new QuanLyKhachSanContext();
    public List<TienNghi> getAllTienNghiOfKhachSan(int? idKS)
    {

        // Kiểm tra idP có giá trị không
        if (idKS == null) return new List<TienNghi>();  // Trả về danh sách rỗng nếu idP là null
        var result = db.KhachSanTienNghis
        .Where(ptn => ptn.IdKhachSan == idKS) // Sử dụng tham số idP
        .Join(db.TienNghis,
        ptn => ptn.IdTienNghi,
        tn => tn.Id,
        (ptn, tn) => tn)  // Trả về các đối tượng TienNghi
        .ToList();  // Chuyển kết quả thành List
        return result;
    }
}
@{
    var text = db.KhachSans.Find(idks);
    var phong = db.Phongs.Where(x => x.IdKhachSan == idks && x.IsDelete == false).ToList();
    var slphong = phong.Count();
}
<!DOCTYPE HTML>
<html lang="en">
<head>
    <!--=============== basic  ===============-->
    <meta charset="UTF-8">
    <title>Easybook - Hotel Booking Directory Listing Template</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="robots" content="index, follow" />
    <meta name="keywords" content="" />
    <meta name="description" content="" />
    <!--=============== css  ===============-->
    <link type="text/css" rel="stylesheet" href="../assets/css/reset.css">
    <link type="text/css" rel="stylesheet" href="../assets/css/plugins.css">
    <link type="text/css" rel="stylesheet" href="../assets/css/style.css">
    <link type="text/css" rel="stylesheet" href="../assets/css/color.css">
    <!--=============== favicons ===============-->
    <link rel="shortcut icon" href="../assets/images/favicon.ico">
    <script src="https://ajax.aspnetcdn.com/ajax/jQuery/jquery-3.5.1.min.js"></script>
    <style>
        .rooms-media img{
	        width:100%;
	        max-height:181px;
            object-fit: cover;
        }
    </style>
</head>

<body>
    <!--loader-->
    <div class="loader-wrap">
        <div class="pin">
            <div class="pulse"></div>
        </div>
    </div>
    <!--loader end-->
    <!-- Main  -->
    <div id="main">
        <!-- header-->
        @await Html.PartialAsync("_PatialHeader")
        <!--  header end -->
        <!--  wrapper  -->
        <div id="wrapper">
            <!-- content-->
            <div class="content">
                <!--  section  -->
                <section class="list-single-hero" data-scrollax-parent="true" id="sec1">
                    <div class="bg par-elem " data-bg="../assets/images/hotels/@text.AnhDaiDien" data-scrollax="properties: { translateY: '30%' }"></div>
                    <div class="list-single-hero-title fl-wrap">
                        <div class="container">
                            <div class="row">
                                <div class="col-md-7">
                                    <div class="listing-rating-wrap">
                                        <div class="listing-rating card-popup-rainingvis" data-starrating2="@text.SoSao"></div>
                                    </div>
                                    <h2><span>@text.TenKhachSan</span></h2>
                                    <div class="list-single-header-contacts fl-wrap">
                                        <ul>
                                            <li><i class="far fa-map-marker-alt"></i><a href="#"></a></li>
                                            <li><i class="far fa-envelope"></i><a href="#"></a></li>
                                        </ul>
                                    </div>
                                </div>
                                <div class="col-md-5">
                                    <!--  list-single-hero-details-->
                                    <div class="list-single-hero-details fl-wrap">
                                        <!--  list-single-hero-rating-->
                                        <div class="list-single-hero-rating">
                                            <div class="rate-class-name">
                                                <div class="score"><strong>Điểm</strong>2 đánh giá</div>
                                                <span id="diem-top">4.5</span>
                                            </div>
                                        </div>
                                        <!--  list-single-hero-rating  end-->
                                        <div class="clearfix"></div>
                                        <!-- list-single-hero-links-->
                                        <div class="list-single-hero-links">
                                            <a class="custom-scroll-link lisd-link" href="#sec6"><i class="fal fa-comment-alt-check"></i>Đánh giá</a>
                                        </div>
                                        <!--  list-single-hero-links end-->
                                    </div>
                                    <!--  list-single-hero-details  end-->
                                </div>
                            </div>
                            <div class="breadcrumbs-hero-buttom fl-wrap">
                                
                            </div>
                        </div>
                    </div>
                </section>
                <!--  section  end-->
                <!--  section  -->
                <section class="grey-blue-bg small-padding scroll-nav-container" id="sec2">
                    <!--  scroll-nav-wrapper  -->
                    <div class="scroll-nav-wrapper fl-wrap">
                        <div class="hidden-map-container fl-wrap">
                            <input id="pac-input" class="controls fl-wrap controls-mapwn" type="text" placeholder="What Nearby ?   Bar , Gym , Restaurant ">
                            <div class="map-container">
                                <div id="singleMap" data-latitude="40.7427837" data-longitude="-73.11445617675781"></div>
                            </div>
                        </div>
                        <div class="clearfix"></div>
                        <div class="container">
                            <nav class="scroll-nav scroll-init">
                                <ul>
                                    <li><a class="act-scrlink" href="#sec1">Top</a></li>
                                    <li><a href="#sec2">Chi tiết</a></li>
                                    <li><a href="#sec3">Tiện nghi</a></li>
                                    <li><a href="#sec4">Phòng</a></li>
                                    <li><a href="#sec5">Đánh giá</a></li>
                                </ul>
                            </nav>
                        </div>
                    </div>
                    <!--  scroll-nav-wrapper end  -->
                    <!--   container  -->
                    <div class="container">
                        <!--   row  -->
                        <div class="row">
                            <!--   datails -->
                            <div class="col-md-8">
                                <div class="list-single-main-container ">
                                    <!-- fixed-scroll-column  -->
                                    <div class="fixed-scroll-column">
                                        <div class="fixed-scroll-column-item fl-wrap">
                                            <div class="showshare sfcs fc-button"><i class="far fa-share-alt"></i><span>Chia sẻ </span></div>
                                            <div class="share-holder fixed-scroll-column-share-container">
                                                <div class="share-container  isShare"></div>
                                            </div>
                                            <a class="fc-button custom-scroll-link" href="#sec6"><i class="far fa-comment-alt-check"></i> <span> Đánh giá </span></a>
                                            <a class="fc-button" href="#"><i class="far fa-heart"></i> <span>Lưu</span></a>
                                        </div>
                                    </div>
                                    <!-- fixed-scroll-column end   -->
                                    <div class="list-single-main-media fl-wrap">
                                        <!-- gallery-items   -->
                                        <div class="gallery-items grid-small-pad  list-single-gallery three-coulms lightgallery">
                                            <!-- 1 -->
                                            <div class="gallery-item ">
                                                <div class="grid-item-holder">
                                                    <div class="box-item">
                                                        <img src="../assets/images/gal/9.jpg" alt="">
                                                        <a href="../assets/images/gal/9.jpg" class="gal-link popup-image"><i class="fa fa-search"></i></a>
                                                    </div>
                                                </div>
                                            </div>
                                            <!-- 1 end -->
                                            <!-- 2 -->
                                            <div class="gallery-item">
                                                <div class="grid-item-holder">
                                                    <div class="box-item">
                                                        <img src="../assets/images/gal/7.jpg" alt="">
                                                        <a href="../assets/images/gal/7.jpg" class="gal-link popup-image"><i class="fa fa-search"></i></a>
                                                    </div>
                                                </div>
                                            </div>
                                            <!-- 2 end -->
                                            <!-- 3 -->
                                            <div class="gallery-item gallery-item-second">
                                                <div class="grid-item-holder">
                                                    <div class="box-item">
                                                        <img src="../assets/images/gal/3.jpg" alt="">
                                                        <a href="../assets/images/gal/3.jpg" class="gal-link popup-image"><i class="fa fa-search"></i></a>
                                                    </div>
                                                </div>
                                            </div>
                                            <!-- 3 end -->
                                            <!-- 4 -->
                                            <div class="gallery-item">
                                                <div class="grid-item-holder">
                                                    <div class="box-item">
                                                        <img src="../assets/images/gal/4.jpg" alt="">
                                                        <a href="../assets/images/gal/4.jpg" class="gal-link popup-image"><i class="fa fa-search"  ></i></a>
                                                    </div>
                                                </div>
                                            </div>
                                            <!-- 4 end -->
                                            <!-- 5 -->
                                            <div class="gallery-item">
                                                <div class="grid-item-holder">
                                                    <div class="box-item">
                                                        <img src="../assets/images/gal/5.jpg" alt="">
                                                        <a href="../assets/images/gal/5.jpg" class="gal-link popup-image"><i class="fa fa-search"  ></i></a>
                                                    </div>
                                                </div>
                                            </div>
                                            <!-- 5 end -->
                                            <!-- 7 -->
                                            <div class="gallery-item">
                                                <div class="grid-item-holder">
                                                    <div class="box-item">
                                                        <img src="../assets/images/gal/6.jpg" alt="">
                                                        <div class="more-photos-button dynamic-gal" data-dynamicPath="[{'src': '../assets/images/gal/2.jpg'}, {'src': '../assets/images/gal/8.jpg'},{'src': '../assets/images/gal/1.jpg'}]">Other <span>4 photos</span><i class="far fa-long-arrow-right"></i></div>
                                                    </div>
                                                </div>
                                            </div>
                                            <!-- 7 end -->
                                        </div>
                                        <!-- end gallery items -->
                                    </div>
                                    <!-- list-single-header end -->
                                    <div class="list-single-facts fl-wrap">
                                        <!-- inline-facts -->
                                        <div class="inline-facts-wrap">
                                            <div class="inline-facts">
                                                <i class="fal fa-bed"></i>
                                                <div class="milestone-counter">
                                                    <div class="stats animaper">
                                                        @slphong
                                                    </div>
                                                </div>
                                                <h6>Phòng</h6>
                                            </div>
                                        </div>
                                        <!-- inline-facts end -->
                                        <!-- inline-facts  -->
                                        <div class="inline-facts-wrap">
                                            <div class="inline-facts">
                                                <i class="fal fa-users"></i>
                                                <div class="milestone-counter">
                                                    <div class="stats animaper">
                                                        2557
                                                    </div>
                                                </div>
                                                <h6>Khách hàng hằng năm</h6>
                                            </div>
                                        </div>
                                    </div>
                                    <!--   list-single-main-item -->
                                    <div class="list-single-main-item fl-wrap">
                                        <div class="list-single-main-item-title fl-wrap">
                                            <h3>Giới thiệu về khách sạn </h3>
                                        </div>
                                        
                                        <p>@text.GhiChu</p>
                                    </div>
                                    <!--   list-single-main-item end -->
                                    <!--   list-single-main-item -->
                                    <div class="list-single-main-item fl-wrap" id="sec3">
                                        <div class="list-single-main-item-title fl-wrap">
                                            <h3>Tiện nghi</h3>
                                        </div>
                                        <div class="listing-features fl-wrap">
                                            <ul>
                                                @foreach (var tiennghi in getAllTienNghiOfKhachSan(idks))
                                                {
                                                    <li><i class="@tiennghi.ClassIcon"></i>@tiennghi.TenTienNghi</li>
                                                }
                                            </ul>
                                        </div>
                                        <span class="fw-separator"></span>                                
                                    </div>
                                    <!--   list-single-main-item end -->
                                    <!--   list-single-main-item -->
                                    <div class="list-single-main-item fl-wrap" id="sec4">
                                        <div class="list-single-main-item-title fl-wrap">
                                            <h3>Danh sách phòng trống</h3>
                                        </div>
                                        <!--   rooms-container -->
                                        <div class="rooms-container fl-wrap">                                         
                                            @if(Model != null){
                                                @foreach(var item in Model){
                                                <!--  rooms-item -->
                                                string rs = string.Join(",", item.ImagePaths);
                                                <div class="rooms-item fl-wrap">
                                                    <div class="rooms-media">
                                                        <img src="../assets/images/phong/@item.Phong.AnhDaiDien" alt="">
                                                        <div class="dynamic-gal more-photos-button" data-dynamicPath="[@rs]"> Ảnh phòng <span>4 ảnh</span> <i class="far fa-long-arrow-right"></i> </div>
                                                    </div>
                                                    <div class="rooms-details">
                                                        <div class="rooms-details-header fl-wrap">
                                                            <span class="rooms-price">@item.Phong.GiaPhong.Value.ToVND()<strong> / đêm</strong></span>
                                                            <h3>@item.Phong.TenPhong</h3>
                                                            <h5>Max Guests: <span>2 người</span></h5>
                                                        </div>
                                                        <div class="facilities-list fl-wrap">
                                                            <ul>
                                                                <li><i class="fal fa-wifi"></i><span>WiFi</span></li>
                                                                <li><i class="fal fa-parking"></i><span>Bãi đỗ xe</span></li>
                                                                <li><i class="fal fa-smoking-ban"></i><span>Phòng không hút thuốc</span></li>
                                                                <li><i class="fal fa-utensils"></i><span>Nhà hàng</span></li>
                                                            </ul>
                                                            <a href="/Phong/ChiTietPhong?idphong=@item.Phong.Id" class="btn color-bg ajax-link">Chi tiết<i class="fas fa-caret-right"></i></a>
                                                        </div>
                                                    </div>
                                                </div>
                                                <!--  rooms-item end -->
                                                }
                                            }
                                            else
                                            {
                                                <h1 class="text-white bg-danger">Không có phòng</h1>
                                            }
                                        </div>
                                        <!--   rooms-container end -->
                                    </div>
                                    <!-- list-single-main-item end -->
                                    <!-- list-single-main-item -->
                                    <div class="list-single-main-item fl-wrap" id="sec5">
                                        <!--reviews-score-wrap-->
                                        
                                    </div>
                                    <!-- list-single-main-item end -->
                                    <!-- list-single-main-item -->
                                    <div class="list-single-main-item fl-wrap" id="sec6">
                                        <div class="list-single-main-item-title fl-wrap">
                                            <h3>Đánh giá</h3>
                                        </div>
                                        <!-- Add Review Box -->
                                        <div id="add-review" class="add-review-box">
                                            <!-- Review Comment -->
                                            <form id="add-comment" class="add-comment custom-form" name="rangeCalc">
                                                <fieldset>
                                                    <div class="review-score-form fl-wrap">
                                                        <div class="review-range-container">
                                                            <!-- review-range-item-->
                                                            <div class="review-range-item">
                                                                <div class="range-slider-title">Sạch sẽ</div>
                                                                <div class="range-slider-wrap">
                                                                    <input id="diemsachse" type="text" class="rate-range" data-min="0" data-max="5" name="rgcl" data-step="1" value="4">
                                                                </div>
                                                            </div>
                                                            <!-- review-range-item end -->
                                                            <!-- review-range-item-->
                                                            <div class="review-range-item">
                                                                <div class="range-slider-title">Thơm</div>
                                                                <div class="range-slider-wrap ">
                                                                    <input id="diemthom" type="text" class="rate-range" data-min="0" data-max="5" name="rgcl" data-step="1" value="1">
                                                                </div>
                                                            </div>
                                                            <!-- review-range-item end -->
                                                            <!-- review-range-item-->
                                                            <div class="review-range-item">
                                                                <div class="range-slider-title">Nhân viên</div>
                                                                <div class="range-slider-wrap ">
                                                                    <input id="diemnhanvien" type="text" class="rate-range" data-min="0" data-max="5" name="rgcl" data-step="1" value="5">
                                                                </div>
                                                            </div>
                                                            <!-- review-range-item end -->
                                                            <!-- review-range-item-->
                                                            <div class="review-range-item">
                                                                <div class="range-slider-title">Cơ sở vật chất</div>
                                                                <div class="range-slider-wrap">
                                                                    <input id="diemcsvc" type="text" class="rate-range" data-min="0" data-max="5" name="rgcl" data-step="1" value="3">
                                                                </div>
                                                            </div>
                                                            <!-- review-range-item end -->
                                                        </div>
                                                        <div class="review-total">.
                                                            <span><input id="tongdiem" type="text" name="rg_total" data-form="AVG({rgcl})" value="0"></span>
                                                            <strong>Điểm</strong>
                                                        </div>
                                                    </div>
                                                    <div class="row">
                                                        
                                                    </div>
                                                    <textarea id="comment" cols="40" rows="3" placeholder="Đánh giá của bạn:"></textarea>
                                                </fieldset>
                                                <button id="guidanhgia" class="btn big-btn flat-btn float-btn color2-bg" style="margin-top:30px">Gửi đánh giá <i class="fal fa-paper-plane"></i></button>
                                            </form>
                                        </div>
                                        <!-- Add Review Box / End -->
                                    </div>
                                    <!-- list-single-main-item end -->
                                </div>
                            </div>
                            <!--   datails end  -->
                            <!--   sidebar  -->
                            <div class="col-md-4">
                                <!--box-widget-wrap -->
                                <div class="box-widget-wrap">
                                    <!--box-widget-item -->
                                    <div class="box-widget-item fl-wrap">
                                        <div id="weather-widget" class="gradient-bg ideaboxWeather" data-city="New York"></div>
                                    </div>
                                    <!--box-widget-item end -->
                                    <!--box-widget-item end -->
                                    <!--box-widget-item -->
                                    
                                    <!--box-widget-item end -->
                                    <!--box-widget-item -->
                                   
                                    <!--box-widget-item end -->
                                    <!--box-widget-item -->
                                    <div class="box-widget-item fl-wrap">
                                        <div class="box-widget">
                                            <div class="box-widget-content">
                                                <div class="box-widget-item-header">
                                                    <h3>Similar Listings</h3>
                                                </div>
                                                <div class="widget-posts fl-wrap">
                                                    <ul>
                                                        <li class="clearfix">
                                                            <a href="#" class="widget-posts-img"><img src="../assets/images/gal/3.jpg" class="respimg" alt=""></a>
                                                            <div class="widget-posts-descr">
                                                                <a href="#" title="">Park Central</a>
                                                                <div class="listing-rating card-popup-rainingvis" data-starrating2="5"></div>
                                                                <div class="geodir-category-location fl-wrap"><a href="#"><i class="fas fa-map-marker-alt"></i> 40 JOURNAL SQUARE PLAZA, NJ, US</a></div>
                                                                <span class="rooms-price">$80 <strong> /  Awg</strong></span>
                                                            </div>
                                                        </li>
                                                        <li class="clearfix">
                                                            <a href="#" class="widget-posts-img"><img src="../assets/images/gal/1.jpg" class="respimg" alt=""></a>
                                                            <div class="widget-posts-descr">
                                                                <a href="#" title="">Holiday Home</a>
                                                                <div class="listing-rating card-popup-rainingvis" data-starrating2="3"></div>
                                                                <div class="geodir-category-location fl-wrap"><a href="#"><i class="fas fa-map-marker-alt"></i> 75 PRINCE ST, NY, USA</a></div>
                                                                <span class="rooms-price">$50 <strong> /   Awg</strong></span>
                                                            </div>
                                                        </li>
                                                        <li class="clearfix">
                                                            <a href="#" class="widget-posts-img"><img src="../assets/images/gal/2.jpg" class="respimg" alt=""></a>
                                                            <div class="widget-posts-descr">
                                                                <a href="#" title="">Moonlight Hotel</a>
                                                                <div class="listing-rating card-popup-rainingvis" data-starrating2="4"></div>
                                                                <div class="geodir-category-location fl-wrap"><a href="#"><i class="fas fa-map-marker-alt"></i>  70 BRIGHT ST NEW YORK, USA</a></div>
                                                                <span class="rooms-price">$105 <strong> /  Awg</strong></span>
                                                            </div>
                                                        </li>
                                                    </ul>
                                                    <a class="widget-posts-link" href="#">See All Listing <i class="fal fa-long-arrow-right"></i> </a>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <!--box-widget-item end -->
                                </div>
                                <!--box-widget-wrap end -->
                            </div>
                            <!--   sidebar end  -->
                        </div>
                        <!--   row end  -->
                    </div>
                    <!--   container  end  -->
                </section>
                <!--  section  end-->
            </div>
            <!-- content end-->
            <div class="limit-box fl-wrap"></div>
        </div>
        <!--wrapper end -->
        <!--footer -->
        @await Html.PartialAsync("_PatialFooter")
        <!--footer end -->
        <a class="to-top"><i class="fas fa-caret-up"></i></a>
        <!--ajax-modal-container-->
        <div class="ajax-modal-overlay"></div>
        <div class="ajax-modal-container">
            <!--ajax-modal -->
            <div class='ajax-loader'>
                <div class='ajax-loader-cirle'></div>
            </div>
            <div id="ajax-modal" class="fl-wrap">
            </div>
            <!--ajax-modal-container end -->
        </div>
        <!--ajax-modal-container end -->
    </div>
    <!-- Main end -->
    <!--=============== scripts  ===============-->
    <script type="text/javascript" src="../assets/js/jquery.min.js"></script>
    <script type="text/javascript" src="../assets/js/plugins.js"></script>
    <script type="text/javascript" src="../assets/js/scripts.js"></script>

    <!--Plugin JavaScript file-->
    <script>
         $(document).ready(function () {
            $('#add-comment').submit(function (event) {
                // Ngăn chặn việc gửi form theo cách thông thường
                event.preventDefault();

                // Lấy dữ liệu từ các trường input
                var diemsachse = $('#diemsachse').val();
                var diemthom = $('#diemthom').val();
                var diemnhanvien = $('#diemnhanvien').val();
                var diemcsvc = $('#diemcsvc').val();
                var dtb = $('#tongdiem').val();
                var comment = $('#comment').val();
                
                // Gửi dữ liệu đi bằng AJAX
                $.ajax({
                type: 'POST',
                url: '/User/DanhGia',
                data: {
                    diemsachse: diemsachse,
                    diemthom: diemthom,
                    diemnhanvien: diemnhanvien,
                    diemcsvc: diemcsvc,
                    dtb: dtb,
                    comment: comment,
                    idks: @idks,
                },
                success: function (response) {
                    // Xử lý khi gửi dữ liệu thành công
                    alert(response.message);
                    $('#comment').val("");
                    // Ví dụ: hiển thị thông báo hoặc thực hiện các hành động khác
                },
                error: function (xhr, status, error) {
                    // Xử lý khi gửi dữ liệu gặp lỗi
                    console.log('Đã xảy ra lỗi khi gửi dữ liệu: ' + error);
                }
                });
            });
            $.ajax({
                type: 'GET',
                url: '/KhachSan/DanhGiaKhachSan?idkhachsan=' + @idks,
                success: function (response) {
                    $('#sec5').empty().append(response);
                },
                error: function (xhr, status, error) {
                    // Xử lý khi gửi dữ liệu gặp lỗi
                    console.log('Đã xảy ra lỗi khi gửi dữ liệu: ' + error);
                }
            });
         });
    </script>
</body>
</html>